<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de contatos</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.10/jquery.mask.js"></script>

</head>

<script>

    var registroSelecionado = -1

    $(function () {

        listar();


        $('input[name="phone-number"]').mask('(00) 0000-0000');
        

        $("#btnSalvar").click(function () {

            var contato = {
                nome: $("#txtNome").val(),
                idade: $("#txtIdade").val(),
                telefone: $("#txtTelefone").val()
            }

            var contatosStorage = JSON.parse(localStorage.getItem("contatos"))

            if (contatosStorage == null) {
                contatosStorage = []
            }

            if (registroSelecionado > -1) {

                contatosStorage[registroSelecionado] = {
                    nome: $("#txtNome").val(),
                    idade: $("#txtIdade").val(),
                    telefone: $("#txtTelefone").val()
                }
            }
            else {
                contatosStorage.push(contato)
            }

            localStorage.setItem("contatos", JSON.stringify(contatosStorage))

            $('input').val('')
            $('#txtNome').focus()

            listar();

            registroSelecionado = -1

        });

        $(document).on('click', '#btnEditar', function () {

            var posicao = $(this).attr('posicao')

            registroSelecionado = posicao

            var contatosStorage = JSON.parse(localStorage.getItem('contatos'))
            var contato = contatosStorage[posicao]

            $('#txtNome').val(contato.nome)
            $('#txtIdade').val(contato.idade)
            $('#txtTelefone').val(contato.telefone)
        })


        $(document).on('click', '#btnExcluir', function () {

            var posicao = $(this).attr('posicao')

            var contatosStorage = JSON.parse(localStorage.getItem('contatos'))
            contatosStorage.splice(posicao, 1)
            
            localStorage.setItem("contatos", JSON.stringify(contatosStorage))

            listar()

        })


    });

    function listar() {

        $('#tblContatos tr:not(:first)').remove();

        var contatosStorage = JSON.parse(localStorage.getItem("contatos"))

        for (var posicao in contatosStorage) {

            var contato = contatosStorage[posicao]

            var botaoExcluir = '<button id="btnExcluir" posicao="' + posicao + '" class="btn btn-danger btn-sm">Excluir</button>'
            var botaoEditar = '<button id="btnEditar" posicao="' + posicao + '" class="btn btn-info btn-sm">Editar</button>'
            var acoes = '<td>' + botaoEditar + botaoExcluir + '</td>'
            var linha = '<tr><td>' + contato.nome + '</td><td>' + contato.idade + '</td><td>' + contato.telefone + '</td>' + acoes + '</tr>'

            $('#tblContatos tr:last').after(linha);
        }

    }

</script>

<style>
    /* .labelcustom {
        color: rgb(43, 226, 95);
    }
    .btn-custom{
        background-color: green;
    } */
</style>

<body>

    <div class="container">
        <div class="row">
            <div class="panel panel-info">
                <div class="panel-heading text-center">
                    <h1><strong>Lista de contatos</strong></h1>
                </div>
                <div class="panel-body">
                    <div class="col-xs-12 col-md-6 col-lg-5">
                        <label class="labelcustom" for="txtNome">Nome:</label>
                        <input id="txtNome" type="text" class="form-control">
                    </div>
                    <div class="col-xs-12 col-md-6 col-lg-3">
                        <label for="txtIdade">Idade:</label>
                        <input id="txtIdade" type="text" class="form-control idade">
                    </div>
                    <div class="col-xs-12 col-md-6 col-lg-3">
                        <label for="txtTelefone">Telefone:</label>
                        <input id="txtTelefone" type="text" name="phone-number"  class="form-control">
                    </div>
                    <div class="col-xs-12 col-md-6 col-lg-1">
                        <br>
                        <button id="btnSalvar" type="button" class="btn btn-primary btn-custom">Salvar</button>
                    </div>
                    <hr>
                    <table id="tblContatos" class="table table-striped table-responsive table-hover">
                        <tbody>
                            <th>Nome</th>
                            <th>Idade</th>
                            <th>Telefone</th>
                            <th>Ações</th>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</body>

</html>